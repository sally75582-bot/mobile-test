<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Genosha Protocol — Mutant Verification</title>
<style>
  :root {
    /* 흑백 테마 */
    --bg: #000000;
    --fg: #f0f0f0;
    --muted: #888888; /* 뮤트색 더 어둡게 */
    --red: #ff2222; 
    --accent: #ffffff; 
    --border: #333333;
    --thin-border: 1px; /* 얇은 테두리 변수 추가 */
  }
  * { box-sizing: border-box; }
  html, body { margin: 0; padding: 0; height: 100%; }

  body {
    background: var(--bg);
    color: var(--fg);
    font-family: ui-monospace, Menlo, Consolas, monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  .frame {
    width: 95%;
    max-width: 800px;
    min-height: 90vh;
    background: #0a0a0a;
    border-radius: 18px;
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0,0,0,.8);
  }

  header {
    padding: 12px 16px; /* 헤더 패딩 살짝 줄임 */
    border-bottom: var(--thin-border) solid var(--border);
    background: #111111;
    text-transform: uppercase;
    letter-spacing: .15em; /* 자간 살짝 늘림 */
    font-size: 11px;
    color: var(--muted);
    display: flex;
    justify-content: space-between;
  }
  header .badge { color: var(--accent); font-weight: bold; }

  .screen {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    font-size: clamp(14px, 2.5vw, 16px); 
    line-height: 1.55;
    position: relative;
    z-index: 1;
  }

  .choices {
    display: flex;
    flex-direction: column;
    gap: 8px; /* 버튼 간격 줄임 */
    margin-top: 16px;
    position: relative;
    z-index: 10; 
  }

  /* 🛠️ 버튼 스타일 대폭 수정 */
  .btn {
    border: var(--thin-border) solid var(--fg); /* 선 두께 줄임 */
    color: var(--fg);
    background: transparent; 
    padding: 10px 14px; /* 버튼 패딩 줄임 */
    border-radius: 2px; /* 더 날카로운 디자인 */
    cursor: pointer;
    font-weight: 700;
    font-size: 14px; /* 폰트 크기 줄임 */
    text-align: center; /* 텍스트 중앙 정렬 */
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: background 0.1s ease, border-color 0.1s ease, transform 0.1s ease;
    opacity: 0; 
    transform: translateY(10px);
  }
  .btn:before {
    content: ''; /* 앞에 붙는 문자 제거 */
    margin: 0;
  }
  .btn:hover, .btn:focus { 
    background: rgba(255, 255, 255, 0.15); /* 호버 효과 강화 */
    border-color: var(--accent);
    outline: none; 
  }
  .btn:active { 
    transform: scale(0.99); 
    background: rgba(255, 255, 255, 0.25);
  }
  .btn[disabled] { opacity: 0.4 !important; pointer-events: none; }

  .footer {
    padding: 10px 14px;
    border-top: var(--thin-border) solid var(--border);
    font-size: 12px;
    color: var(--muted);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 6px;
  }

  .bar {
    height: 6px; /* 진행 바 두께 줄임 */
    border-radius: 999px;
    background: #121212;
    overflow: hidden;
    width: 40%;
  }
  .bar > span {
    display: block;
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #333, var(--fg)); 
    transition: width 0.3s ease;
  }

  pre#output { white-space: pre-wrap; word-wrap: break-word; margin: 0; }
  
  /* 글리치 애니메이션 */
  @keyframes glitch {
    0% { text-shadow: 1px 0 0 var(--red), -1px 0 0 var(--accent); transform: translate3d(0, 0, 0); }
    50% { text-shadow: -1px 0 0 var(--red), 1px 0 0 var(--accent); transform: translate3d(1px, 0, 0); }
    100% { text-shadow: 1px 0 0 var(--red), -1px 0 0 var(--accent); transform: translate3d(-1px, 0, 0); }
  }
  .glitch-text { animation: glitch 0.1s linear infinite alternate; }

  /* 버튼 등장 애니메이션 */
  @keyframes fadeInSlide {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* 🛠️ 팝업 디자인 대폭 개선 */
  .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(1px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
  }
  .popup-content {
      background: #000000;
      padding: 30px;
      border-radius: 0; /* 각진 팝업 */
      text-align: center;
      max-width: 90%;
      width: 350px; /* 고정 너비로 세련되게 */
      transition: all 0.3s ease-in-out;
      
      /* 🛠️ 기본 성공 팝업 테두리 */
      border: var(--thin-border) double var(--fg); 
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
  }
  .popup-content.fail {
      /* 🛠️ 실패 팝업 테두리 */
      border: var(--thin-border) double var(--red); 
      box-shadow: 0 0 20px var(--red);
  }
  .popup-content h2 {
      margin-top: 0;
      font-size: 20px; /* 제목 폰트 크기 줄임 */
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent);
      margin-bottom: 5px;
  }
  /* 🛠️ 실패 팝업 제목 (GLITCHING 텍스트 삭제 반영) */
  .popup-content.fail h2 {
      color: var(--red);
      animation: none; /* 제목에서 글리치 애니메이션 제거 */
  }
  .popup-content p {
      color: var(--muted);
      margin: 10px 0 20px 0;
      font-size: 13px; /* 메시지 폰트 크기 줄임 */
      line-height: 1.4;
  }
  .popup-content.fail p {
      color: var(--red);
      font-weight: 500;
  }
</style>
</head>
<body>
<div class="frame">
  <header>
    <div>GENOSHA <span class="badge">/ PROTOCOL</span></div>
    <div class="dim">VER. 1.1</div>
  </header>
  <div class="screen" id="screen">
    <pre id="output">[STATUS]: Awaiting Input.</pre>
    <div class="choices" id="choices"></div>
  </div>
  <div class="footer">
    <div>MUTANT SCORE: <span id="status" class="accent">0 / 6</span></div>
    <div class="bar"><span id="progress"></span></div>
  </div>
</div>

<script>
window.onload = function(){
  const out = document.getElementById('output');
  const choicesEl = document.getElementById('choices');
  const statusEl = document.getElementById('status');
  const progressEl = document.getElementById('progress');

  function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
  async function flush(){ return new Promise(r=>setTimeout(r,0)); }

  async function type(line='', delay=14){
    for(let i=0;i<line.length;i++){
      out.textContent += line[i];
      await flush();
      await sleep(delay);
    }
    out.textContent += '\n';
    out.scrollTop = out.scrollHeight;
    await flush();
  }

  function clearOutput(){ out.textContent=''; }
  function setStatus(score){ statusEl.textContent=score+' / 6'; }
  function setProgress(p){ progressEl.style.width = Math.min(100, Math.max(0,p))+'%'; }

  function btn(label,cb, index){
    const b=document.createElement('button');
    b.className='btn';
    b.textContent=label;
    
    // 버튼 애니메이션 적용
    b.style.animation = `fadeInSlide 0.3s ease-out forwards ${index * 0.1}s`; 
    
    const handler = async (e) => {
        b.removeEventListener('touchend', handler);
        b.removeEventListener('click', handler);
        b.disabled=true;
        
        Array.from(choicesEl.children).forEach(child => {
            child.disabled = true;
        });

        await cb();
    };
    
    b.addEventListener('touchend', handler);
    b.addEventListener('click', handler);
    
    return b;
  }
  
  // 팝업 표시 함수
  function showPopup(type, title, message) {
      const overlay = document.createElement('div');
      overlay.className = 'popup-overlay';
      
      const content = document.createElement('div');
      content.className = 'popup-content ' + (type === 'fail' ? 'fail' : 'pass');
      
      // 🛠️ 팝업 버튼 (acknowledge) 복구
      content.innerHTML = `
          <h2>${title}</h2>
          <p>${message}</p>
          <button class="btn" style="margin-top: 5px; width: 100%; text-align: center; border-radius: 2px; animation: none;">Acknowledge</button>
      `;
      
      const ackBtn = content.querySelector('.btn');
      ackBtn.addEventListener('click', () => {
          document.body.removeChild(overlay);
          if (type === 'fail') {
              // 실패 시 강제 리로드 (첫 페이지로 이동)
              location.reload(); 
          } else {
              // 성공 시 다음 페이지로 랜딩 (임시)
              window.location.href = "http://simp.ly/publish/m1r6vd"; 
          }
      });
      
      overlay.appendChild(content);
      document.body.appendChild(overlay);
  }

  // 퀘스트 데이터
  const qs = [
    {q:'What does your heart truly see in \'Humanity\'?', a:[
      {label:'Love, Hope, Equality',s:0},
      {label:'Fear, Hatred, Disgust',s:2}
    ]},
    {q:'If Prof. X dreams of \'Coexistence\', what does Magneto demand for our kind?', a:[
      {label:'Tolerance',s:0},
      {label:'Supremacy',s:2}
    ]},
    {q:'Genosha\'s shadow is long. What is needed to rebuild our home: blood or metal?', a:[
      {label:'Blood',s:0},
      {label:'Metal',s:2}
    ]}
  ];

  const introText = [
    '[SYSTEM]: Genosha Access Point Activated.',
    'I swore then that I would not rest \'til I had created a world where my kind—mutants—could live free and safe and unafraid.',
    'Prove your loyalty. Prove your difference.'
  ];
  
  const state={i:0,score:0};

  async function begin(){
    clearOutput(); choicesEl.innerHTML='';
    setStatus(0);
    await type('[BOOT SEQUENCE STARTED]', 10);
    for(const l of introText) await type(l, 20);
    next();
  }

  async function next(){
    if(state.i>=qs.length){return analyze();}
    
    const q=qs[state.i];
    await type(`[QUESTION ${state.i + 1}/3]: ${q.q}`, 18);
    choicesEl.innerHTML='';
    
    q.a.forEach((opt, index)=>{
      choicesEl.appendChild(btn(opt.label, async()=>{
        state.score+=opt.s;
        await type('> '+opt.label,10);
        setStatus(state.score);
        state.i++;
        next();
      }, index)); 
    });
    document.getElementById('screen').scrollTop = document.getElementById('screen').scrollHeight;
  }

  async function analyze(){
    choicesEl.innerHTML='';
    
    out.classList.add('glitch-text');
    
    await type('[SYSTEM]: Verifying Mutant Strain...',12);
    for(let p=0;p<=100;p+=10){ setProgress(p); await sleep(100); }
    
    out.classList.remove('glitch-text');
    
    const finalScore = state.score;

    if(finalScore >= 4) { // 4점 이상: 통과
        await type('[VERDICT]: MUTANT - APPROVED. WELCOME HOME.', 14);
        showPopup('pass', 
                  'ACCESS GRANTED', 
                  'Your loyalty is confirmed. The future is ours.');
    } else { // 3점 이하: 실패 (인간)
        await type('[VERDICT]: HUMAN - DENIED. IMMEDIATELY LEAVE TERRITORY.', 14);
        // 🛠️ 실패 팝업 제목 및 메시지 수정 (GLITCHING 제거)
        showPopup('fail', 
                  'ERROR: HUMAN DETECTED', 
                  'WARNING: Your weak resolve cannot be trusted. You are a threat. EXPULSION IMMINENT.');
    }
  }

  // 초기 화면 세팅
  setStatus(0);
  const beginBtn = btn('BEGIN PROTOCOL', begin, 0); 
  beginBtn.style.animation = 'none';
  beginBtn.style.opacity = '1';
  beginBtn.style.transform = 'translateY(0)';
  choicesEl.appendChild(beginBtn);
};
</script>
</body>
</html>
